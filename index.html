<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>운동 따라하기 - Video Exercise Trainer</title>

    <!-- Meta Tags -->
    <meta name="description" content="유튜브 영상을 보며 웹캠으로 자세를 확인하는 홈트레이닝 도우미." />
    <meta name="theme-color" content="#0a0e27" />

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">

    <!-- CSS (Separated) -->
    <link rel="stylesheet" href="style.css?v=final_fix_v7">
</head>

<body>
    <div class="container overlay-mode">
        <!-- Refresh Button (Fixed) -->
        <button class="refresh-overlay" onclick="location.reload()" title="새로고침">
            <span class="material-symbols-outlined">refresh</span>
        </button>
        <!-- Exercise Timer (Fixed) -->
        <div id="exerciseTimer" class="timer-overlay">00:00:00</div>
        <div id="scoreDisplay" class="score-overlay" style="display: none;">SCORE: 0</div>

        <!-- Default: Overlay Mode -->
        <!-- Video Panel -->
        <div class="panel video-panel">
            <div class="player-wrapper">
                <div id="player"></div>

                <!-- Exercise Timer -->


                <!-- Desktop Speed Controls -->
                <div class="speed-overlay">
                    <button class="speed-btn" data-speed="0.5">0.5x</button>
                    <button class="speed-btn" data-speed="0.75">0.75x</button>
                    <button class="speed-btn active" data-speed="1">1x</button>
                    <button class="speed-btn" data-speed="1.25">1.25x</button>
                    <button class="speed-btn" data-speed="1.5">1.5x</button>
                    <button class="speed-btn" data-speed="2">2x</button>
                </div>
            </div>

            <!-- Next Video Bar -->
            <div class="next-video-bar">
                <button class="ctrl-btn btn-icon-only" onclick="playNext()" title="다음 영상">
                    <span class="material-symbols-outlined">skip_next</span>
                </button>
                <div class="next-info">
                    <span class="next-label">다음:</span>
                    <span class="next-title" id="nextTitle">-</span>
                </div>

                <!-- Mobile Settings -->
                <div class="settings-container">
                    <button class="ctrl-btn btn-icon-only" onclick="toggleSpeedMenu()">
                        <span class="material-symbols-outlined">settings</span>
                    </button>
                    <div class="speed-menu" id="speedMenu">
                        <div class="speed-menu-title">재생 속도</div>
                        <div class="speed-options">
                            <button class="speed-btn" data-speed="0.5">0.5x</button>
                            <button class="speed-btn" data-speed="0.75">0.75x</button>
                            <button class="speed-btn active" data-speed="1">1x</button>
                            <button class="speed-btn" data-speed="1.25">1.25x</button>
                            <button class="speed-btn" data-speed="1.5">1.5x</button>
                            <button class="speed-btn" data-speed="2">2x</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Webcam Panel -->
        <div class="panel webcam-panel">
            <video id="webcam" style="display: none;" autoplay playsinline></video>
            <canvas id="output_canvas" style="display: none;"></canvas>
            <div class="placeholder" id="placeholder">웹캠 연결 중...</div>
        </div>
    </div>

    <!-- Bottom Controls -->
    <div class="controls">
        <button class="ctrl-btn" onclick="playPrevious()" title="이전">
            <span class="material-symbols-outlined">skip_previous</span>
            <span class="btn-text">이전</span>
        </button>
        <button class="ctrl-btn" onclick="seek(-10)" title="-10초">
            <span class="material-symbols-outlined">replay_10</span>
        </button>
        <button class="ctrl-btn" onclick="togglePlay()">
            <span class="material-symbols-outlined" id="playIcon">play_arrow</span>
        </button>
        <button class="ctrl-btn" onclick="seek(10)" title="+10초">
            <span class="material-symbols-outlined">forward_10</span>
        </button>
        <button class="ctrl-btn" onclick="playNext()" title="다음">
            <span class="material-symbols-outlined">skip_next</span>
            <span class="btn-text">다음</span>
        </button>
        <button class="ctrl-btn" onclick="togglePlaylist()" title="목록">
            <span class="material-symbols-outlined">playlist_play</span>
        </button>
        <button class="ctrl-btn active" onclick="toggleWebcam()" id="webcamBtn" title="웹캠">
            <span class="material-symbols-outlined">videocam</span>
        </button>
        <button class="ctrl-btn" onclick="toggleFlip()" id="flipBtn" title="반전">
            <span class="material-symbols-outlined">flip_camera_android</span>
        </button>

        <!-- Divider -->
        <div style="width:1px; height:20px; background:rgba(255,255,255,0.3); margin:0 5px;"></div>

        <!-- Layout Toggle & Opacity -->
        <button class="ctrl-btn" onclick="toggleLayout()" title="화면 모드">
            <span class="material-symbols-outlined" id="layoutIcon">layers</span>
        </button>

        <div class="opacity-container">
            <span class="material-symbols-outlined" style="font-size: 18px">opacity</span>
            <input type="range" id="opacitySlider" min="0.1" max="1" step="0.1" value="0.5"
                oninput="updateOpacityFromSlider(this.value)" title="웹캠 투명도">
        </div>


        <div class="sensitivity-container">
            <span class="material-symbols-outlined" style="font-size: 18px">speed</span>
            <div class="slider-wrapper">
                <span class="slider-label">민감-둔감</span>
                <input type="range" id="sensitivitySlider" min="0" max="100" step="1" value="50"
                    oninput="updateSensitivityFromSlider(this.value)">
            </div>
        </div>
    </div>

    <!-- Playlist Modal -->
    <div class="playlist-modal" id="playlistModal">
        <div class="modal-header">
            <h2>플레이리스트 (<span id="count">0</span>)</h2>
            <button class="close-btn" onclick="togglePlaylist()">✕</button>
        </div>
        <div id="playlistItems"></div>
        <div class="add-form">
            <input type="text" id="urlInput" class="input-field" placeholder="YouTube URL 또는 ID">
            <input type="text" id="titleInput" class="input-field" placeholder="제목">
            <button class="ctrl-btn" style="width:100%; justify-content:center; margin-top:10px;" onclick="addVideo()">
                <span class="material-symbols-outlined">add</span> 추가
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <script type="module" src="script.js?v=final_fix_v8"></script>
</body>

</html>